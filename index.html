<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Motor & Relay Control</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f4f4f9;
    color: #333;
  }
  h2 {
    margin-top: 30px;
  }
  p {
    font-size: 22px;
  }
  button {
    width: 160px;
    height: 70px;
    font-size: 22px;
    margin: 10px;
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    box-shadow: 0 5px #666;
  }
  button:active {
    box-shadow: 0 2px #666;
    transform: translateY(4px);
  }
  .on { background: limegreen; }
  .off { background: tomato; }
  .idle { background: gray; }

  hr { margin: 30px 0; }
</style>
</head>

<body>

<h2>3-Phase Motor Control</h2>
<p>Status: <b id="motorStatus">OFF</b></p>
<button id="motorOn" class="idle" onclick="send('motor/control','ON')">Motor ON</button>
<button id="motorOff" class="idle" onclick="send('motor/control','OFF')">Motor OFF</button>

<hr>

<h2>Relay Controls</h2>

<div>
  <p>Relay 1</p>
  <button onclick="send('relay/1','ON')">ON</button>
  <button onclick="send('relay/1','OFF')">OFF</button>
</div>

<div>
  <p>Relay 2</p>
  <button onclick="send('relay/2','ON')">ON</button>
  <button onclick="send('relay/2','OFF')">OFF</button>
</div>

<div>
  <p>Relay 3</p>
  <button onclick="send('relay/3','ON')">ON</button>
  <button onclick="send('relay/3','OFF')">OFF</button>
</div>

<div>
  <p>Relay 4</p>
  <button onclick="send('relay/4','ON')">ON</button>
  <button onclick="send('relay/4','OFF')">OFF</button>
</div>

<hr>

<p>MQTT Status: <b id="mqttStatus">Disconnected</b></p>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
  const broker = 'wss://93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud:8884/mqtt';

  const options = {
    username: 'tohits',
    password: 'toh123@TOH',
    reconnectPeriod: 1000
  };

  const client = mqtt.connect(broker, options);

  const mqttStatus = document.getElementById('mqttStatus');
  const motorStatus = document.getElementById('motorStatus');
  const motorOn = document.getElementById('motorOn');
  const motorOff = document.getElementById('motorOff');

  function send(topic, msg) {
    if (client.connected) {
      client.publish(topic, msg);
    } else {
      alert("MQTT not connected");
    }
  }

  client.on('connect', () => {
    mqttStatus.innerText = 'Connected';
    mqttStatus.style.color = 'green';
    client.subscribe('motor/status');
  });

  client.on('offline', () => {
    mqttStatus.innerText = 'Offline';
    mqttStatus.style.color = 'red';
  });

  client.on('message', (topic, message) => {
    if (topic === 'motor/status') {
      const status = message.toString();
      motorStatus.innerText = status;

      if (status === 'ON') {
        motorOn.className = 'on';
        motorOff.className = 'idle';
      } else {
        motorOff.className = 'off';
        motorOn.className = 'idle';
      }
    }
  });
</script>

</body>
</html>
