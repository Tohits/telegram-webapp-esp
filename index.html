<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3-Phase Motor & 4 Relay Control</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f4f4f9;
    color: #333;
  }
  h2 {
    margin-top: 20px;
  }
  p {
    font-size: 22px;
  }
  .button {
    width: 140px;
    height: 60px;
    font-size: 20px;
    margin: 10px;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    box-shadow: 0 5px #666;
    transition: 0.2s;
  }
  .button:active {
    box-shadow: 0 2px #666;
    transform: translateY(4px);
  }

  #motorON { background: gray; }
  #motorOFF { background: gray; }

  #relay1ON { background: gray; }
  #relay1OFF { background: gray; }
  #relay2ON { background: gray; }
  #relay2OFF { background: gray; }
  #relay3ON { background: gray; }
  #relay3OFF { background: gray; }
  #relay4ON { background: gray; }
  #relay4OFF { background: gray; }

  #mqttStatus {
    font-weight: bold;
    font-size: 20px;
  }

  #waterLevel {
    font-weight: bold;
    font-size: 24px;
    color: #007BFF;
  }
</style>
</head>
<body>

<h2>3-Phase Motor & 4 Relay Control</h2>

<p>Motor Status: <b id="motorStatus">OFF</b></p>
<button id="motorON" class="button" onclick="sendCommand('motor/control','ON')">ON</button>
<button id="motorOFF" class="button" onclick="sendCommand('motor/control','OFF')">OFF</button>

<h3>Relay Controls</h3>
<p>Relay 1: <b id="relay1Status">OFF</b></p>
<button id="relay1ON" class="button" onclick="sendCommand('relay/1','ON')">ON</button>
<button id="relay1OFF" class="button" onclick="sendCommand('relay/1','OFF')">OFF</button>

<p>Relay 2: <b id="relay2Status">OFF</b></p>
<button id="relay2ON" class="button" onclick="sendCommand('relay/2','ON')">ON</button>
<button id="relay2OFF" class="button" onclick="sendCommand('relay/2','OFF')">OFF</button>

<p>Relay 3: <b id="relay3Status">OFF</b></p>
<button id="relay3ON" class="button" onclick="sendCommand('relay/3','ON')">ON</button>
<button id="relay3OFF" class="button" onclick="sendCommand('relay/3','OFF')">OFF</button>

<p>Relay 4: <b id="relay4Status">OFF</b></p>
<button id="relay4ON" class="button" onclick="sendCommand('relay/4','ON')">ON</button>
<button id="relay4OFF" class="button" onclick="sendCommand('relay/4','OFF')">OFF</button>

<h3>Water Level: <span id="waterLevel">--%</span></h3>

<p>MQTT Status: <span id="mqttStatus">Disconnected</span></p>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
const broker = 'wss://93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud:8884/mqtt';
const options = {
  username: 'tohits',
  password: 'toh123@TOH',
  reconnectPeriod: 1000,
  clean: true,
  connectTimeout: 4000,
};
const client = mqtt.connect(broker, options);

// Elements
const motorStatusEl = document.getElementById('motorStatus');
const relayStatusEl = [
  document.getElementById('relay1Status'),
  document.getElementById('relay2Status'),
  document.getElementById('relay3Status'),
  document.getElementById('relay4Status')
];
const mqttStatusEl = document.getElementById('mqttStatus');
const waterLevelEl = document.getElementById('waterLevel');

// Button arrays
const motorButtons = [document.getElementById('motorON'), document.getElementById('motorOFF')];
const relayButtons = [
  [document.getElementById('relay1ON'), document.getElementById('relay1OFF')],
  [document.getElementById('relay2ON'), document.getElementById('relay2OFF')],
  [document.getElementById('relay3ON'), document.getElementById('relay3OFF')],
  [document.getElementById('relay4ON'), document.getElementById('relay4OFF')]
];

// Send MQTT command
function sendCommand(topic, cmd){
  if(client.connected()) client.publish(topic, cmd);
  else alert('MQTT not connected!');
}

// Update button colors like motor
function updateButtonColors(elStatus, buttons, status){
  elStatus.innerText = status;
  if(status==='ON'){
    buttons[0].style.background = 'limegreen';
    buttons[1].style.background = 'gray';
  } else if(status==='OFF'){
    buttons[0].style.background = 'gray';
    buttons[1].style.background = 'tomato';
  } else {
    buttons[0].style.background = 'gray';
    buttons[1].style.background = 'gray';
  }
}

// MQTT events
client.on('connect', () => {
  mqttStatusEl.innerText = 'Connected';
  mqttStatusEl.style.color = 'limegreen';

  client.subscribe('motor/status');
  client.subscribe('relay/1');
  client.subscribe('relay/2');
  client.subscribe('relay/3');
  client.subscribe('relay/4');
  client.subscribe('sensor/waterLevel');
});

client.on('reconnect', () => { mqttStatusEl.innerText='Reconnecting...'; mqttStatusEl.style.color='orange'; });
client.on('offline', () => { mqttStatusEl.innerText='Offline'; mqttStatusEl.style.color='red'; });
client.on('close', () => { mqttStatusEl.innerText='Disconnected'; mqttStatusEl.style.color='red'; });
client.on('error', (err) => { mqttStatusEl.innerText='Error'; mqttStatusEl.style.color='red'; console.error(err); });

// Message handling
client.on('message', (topic, message) => {
  const msg = message.toString();
  if(topic==='motor/status') updateButtonColors(motorStatusEl,motorButtons,msg);
  else if(topic==='relay/1') updateButtonColors(relayStatusEl[0],relayButtons[0],msg);
  else if(topic==='relay/2') updateButtonColors(relayStatusEl[1],relayButtons[1],msg);
  else if(topic==='relay/3') updateButtonColors(relayStatusEl[2],relayButtons[2],msg);
  else if(topic==='relay/4') updateButtonColors(relayStatusEl[3],relayButtons[3],msg);
  else if(topic==='sensor/waterLevel') waterLevelEl.innerText = msg + '%';
});
</script>
</body>
</html>
