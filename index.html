<!DOCTYPE html>
<html>
<head>
  <title>MQTT Motor Control</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
</head>
<body>
  <h2>Motor Control Panel</h2>
  <button onclick="sendCommand('forward')">Forward</button>
  <button onclick="sendCommand('backward')">Backward</button>
  <button onclick="sendCommand('stop')">Stop</button>
  <p id="status">Connecting to MQTT...</p>

  <script>
    // ✅ Use HiveMQ public broker WebSocket Secure (wss)
    const broker = "broker.hivemq.com";
    const port = 8884;   // secure websocket port
    const topic = "tohid/motor";

    // Use SSL secure connection
    let client = new Paho.MQTT.Client(broker, port, "webClient-" + Math.random());

    client.onConnectionLost = (responseObject) => {
      document.getElementById("status").innerText = "Connection lost: " + responseObject.errorMessage;
    };

    client.onMessageArrived = (message) => {
      document.getElementById("status").innerText = "Received: " + message.payloadString;
    };

    client.connect({
      useSSL: true,   // ✅ important for GitHub-hosted pages
      onSuccess: () => {
        document.getElementById("status").innerText = "Connected to MQTT";
      },
      onFailure: (err) => {
        document.getElementById("status").innerText = "Failed to connect: " + JSON.stringify(err);
      }
    });

    function sendCommand(cmd) {
      let message = new Paho.MQTT.Message(cmd);
      message.destinationName = topic;
      client.send(message);
      document.getElementById("status").innerText = "Sent: " + cmd;
    }
  </script>
</body>
</html>
