<!DOCTYPE html>
<html>
<head>
  <title>Relay Control</title>
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>
  <h2>4-Channel Relay Control</h2>
  <button onclick="sendRelayCommand(1, true)">Relay 1 ON</button>
  <button onclick="sendRelayCommand(1, false)">Relay 1 OFF</button><br>
  <button onclick="sendRelayCommand(2, true)">Relay 2 ON</button>
  <button onclick="sendRelayCommand(2, false)">Relay 2 OFF</button><br>
  <button onclick="sendRelayCommand(3, true)">Relay 3 ON</button>
  <button onclick="sendRelayCommand(3, false)">Relay 3 OFF</button><br>
  <button onclick="sendRelayCommand(4, true)">Relay 4 ON</button>
  <button onclick="sendRelayCommand(4, false)">Relay 4 OFF</button>

  <script>
    // Update these as needed
    const MQTT_BROKER = "93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud";
    const MQTT_PORT = 8000; // websocket port
    const MQTT_USER = "tohits";
    const MQTT_PASSWORD = "toh123@TOH";
    const MQTT_TOPIC_RELAY = "relay/control";

    const clientID = "webclient_" + Math.floor(Math.random() * 1000);
    const client = new Paho.MQTT.Client(MQTT_BROKER, MQTT_PORT, clientID);

    client.onConnectionLost = function(responseObject) {
      console.log("Connection lost: " + responseObject.errorMessage);
    };

    client.onMessageArrived = function(message) {
      console.log("Message arrived: " + message.payloadString);
    };

    function onConnect() {
      console.log("Connected to MQTT broker");
      // You can subscribe here if needed
    }

    client.connect({
      userName: MQTT_USER,
      password: MQTT_PASSWORD,
      onSuccess: onConnect,
      useSSL: true,
      mqttVersion: 4
    });

    function sendRelayCommand(ch, on) {
      const msgObj = { ch: ch, on: on };
      const msgStr = JSON.stringify(msgObj);
      const message = new Paho.MQTT.Message(msgStr);
      message.destinationName = MQTT_TOPIC_RELAY;
      client.send(message);
      console.log("Sent:", msgStr);
    }
  </script>
</body>
</html>
