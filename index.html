<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Motor & Relay Control</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f4f4f9;
    color: #333;
  }
  h2 { margin-top: 30px; }
  p { font-size: 22px; }
  button {
    width: 160px;
    height: 70px;
    font-size: 22px;
    margin: 10px;
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    box-shadow: 0 5px #666;
  }
  button:active { box-shadow: 0 2px #666; transform: translateY(4px); }
  .on { background: limegreen; }
  .off { background: tomato; }
  .idle { background: gray; }
  hr { margin: 30px 0; }
</style>
</head>

<body>

<h2>Motor Control</h2>
<p>Status: <b id="motorStatus">OFF</b></p>
<button id="motorOn" class="idle" onclick="send('motor/control','ON')">ON</button>
<button id="motorOff" class="idle" onclick="send('motor/control','OFF')">OFF</button>

<hr>

<h2>Relay Controls</h2>

<div>
  <p>Relay 1</p>
  <button id="relay1On" class="idle" onclick="send('relay/1','ON')">ON</button>
  <button id="relay1Off" class="idle" onclick="send('relay/1','OFF')">OFF</button>
</div>

<div>
  <p>Relay 2</p>
  <button id="relay2On" class="idle" onclick="send('relay/2','ON')">ON</button>
  <button id="relay2Off" class="idle" onclick="send('relay/2','OFF')">OFF</button>
</div>

<div>
  <p>Relay 3</p>
  <button id="relay3On" class="idle" onclick="send('relay/3','ON')">ON</button>
  <button id="relay3Off" class="idle" onclick="send('relay/3','OFF')">OFF</button>
</div>

<div>
  <p>Relay 4</p>
  <button id="relay4On" class="idle" onclick="send('relay/4','ON')">ON</button>
  <button id="relay4Off" class="idle" onclick="send('relay/4','OFF')">OFF</button>
</div>

<hr>

<p>MQTT Status: <b id="mqttStatus">Disconnected</b></p>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
  const broker = 'wss://93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud:8884/mqtt';
  const options = { username:'tohits', password:'toh123@TOH', reconnectPeriod:1000 };
  const client = mqtt.connect(broker, options);

  const mqttStatus = document.getElementById('mqttStatus');
  const motorStatus = document.getElementById('motorStatus');
  const motorOn = document.getElementById('motorOn');
  const motorOff = document.getElementById('motorOff');

  const relays = [
    {on: document.getElementById('relay1On'), off: document.getElementById('relay1Off')},
    {on: document.getElementById('relay2On'), off: document.getElementById('relay2Off')},
    {on: document.getElementById('relay3On'), off: document.getElementById('relay3Off')},
    {on: document.getElementById('relay4On'), off: document.getElementById('relay4Off')}
  ];

  function send(topic, msg){ if(client.connected) client.publish(topic, msg); else alert("MQTT not connected"); }

  function updateButtons(status, onBtn, offBtn){
    if(status==='ON'){ onBtn.className='on'; offBtn.className='idle'; }
    else if(status==='OFF'){ onBtn.className='idle'; offBtn.className='off'; }
    else{ onBtn.className='idle'; offBtn.className='idle'; }
  }

  client.on('connect', () => {
    mqttStatus.innerText = 'Connected'; mqttStatus.style.color='green';
    client.subscribe('motor/status');
    client.subscribe('relay/1'); client.subscribe('relay/2'); client.subscribe('relay/3'); client.subscribe('relay/4');
  });

  client.on('offline', () => { mqttStatus.innerText='Offline'; mqttStatus.style.color='red'; });

  client.on('message', (topic,message) => {
    const status = message.toString();
    if(topic==='motor/status') updateButtons(status, motorOn, motorOff), motorStatus.innerText=status;
    else if(topic==='relay/1') updateButtons(status, relays[0].on, relays[0].off);
    else if(topic==='relay/2') updateButtons(status, relays[1].on, relays[1].off);
    else if(topic==='relay/3') updateButtons(status, relays[2].on, relays[2].off);
    else if(topic==='relay/4') updateButtons(status, relays[3].on, relays[3].off);
  });
</script>

</body>
</html>
