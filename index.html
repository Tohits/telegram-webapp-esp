<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Home Control</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body{font-family:sans-serif;background:#e0f7fa;padding:10px;}
.card{background:#fff;padding:20px;margin:10px auto;border-radius:10px;max-width:500px;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
input[type=range]{width:90%;}
</style>
</head>
<body>

<div class="card">
<h2>Status</h2>
<p>Water: <span id="water">--</span>%</p>
<p>Rain: <span id="rain">--</span></p>
<p>Motor Pulse: <span id="pulse">--</span></p>
</div>

<div class="card">
<h2>Curtains Control</h2>
<input type="range" min="0" max="100" value="0" id="curtainSlider">
<p>Selected: <span id="curtainVal">0%</span></p>
</div>

<div class="card">
<h2>Relays</h2>
<div>
<label>Relay 1: <input type="checkbox" id="relay1"></label>
<label>Relay 2: <input type="checkbox" id="relay2"></label>
<label>Relay 3: <input type="checkbox" id="relay3"></label>
<label>Relay 4: <input type="checkbox" id="relay4"></label>
</div>
</div>

<script>
const broker = "93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud";
const port = 8000;
const client = mqtt.connect(`wss://${broker}:${port}`, {username:"tohits", password:"toh123@TOH"});

client.on('connect', () => {
  console.log("Connected to MQTT");
  client.subscribe("home/waterlevel");
  client.subscribe("home/rain");
});

client.on('message', (topic, message) => {
  const msg = message.toString();
  if(topic=="home/waterlevel") document.getElementById('water').innerText = msg;
  if(topic=="home/rain") document.getElementById('rain').innerText = msg;
});

document.getElementById('curtainSlider').addEventListener('input', e=>{
  document.getElementById('curtainVal').innerText = e.target.value + "%";
  client.publish('home/curtain', e.target.value);
});

['relay1','relay2','relay3','relay4'].forEach(id=>{
  document.getElementById(id).addEventListener('change', e=>{
    client.publish('home/'+id, e.target.checked?"ON":"OFF");
  });
});
</script>
</body>
</html>
